import { processPDF } from './pdf-processor.js';

// PocketBase Initialization
const pbUrl = import.meta.env.VITE_POCKETBASE_URL || 'https://pocketbase.koolgrowth.com';
const pb = new window.PocketBase(pbUrl);

// Official Koolbrand Logo (Data URI)
const KOOLBRAND_LOGO_DATA = "data:image/png;base64,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";

const loginView = document.getElementById('login-view');
const appView = document.getElementById('app-view');
const loginForm = document.getElementById('login-form');
const logoutBtn = document.getElementById('logout-btn');
const userEmailText = document.getElementById('user-email');

const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');
const statusArea = document.getElementById('status-area');
const progressBar = document.getElementById('progress-fill');
const percentageText = document.getElementById('percentage');
const pageCountText = document.getElementById('page-count');
const fileNameText = document.getElementById('file-name');
const actionArea = document.getElementById('action-area');
const downloadBtn = document.getElementById('download-btn');
const resetBtn = document.getElementById('reset-btn');
const processLabel = document.getElementById('process-label');

// Auth Flow
function checkAuth() {
    if (pb.authStore.isValid) {
        loginView.classList.add('hidden');
        appView.classList.remove('hidden');
        userEmailText.textContent = pb.authStore.model.email;
    } else {
        loginView.classList.remove('hidden');
        appView.classList.add('hidden');
    }
}

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const loginBtn = document.getElementById('login-btn');

    try {
        loginBtn.disabled = true;
        loginBtn.textContent = 'Entrando...';
        await pb.collection('users').authWithPassword(email, password);
        checkAuth();
    } catch (error) {
        alert('Error de login: ' + error.message);
    } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Entrar';
    }
});

logoutBtn.addEventListener('click', () => {
    pb.authStore.clear();
    checkAuth();
    resetApp();
});

// Initial Auth Check
checkAuth();

let processedBlob = null;
let originalFileName = "";

// Event Listeners
dropZone.addEventListener('click', () => fileInput.click());

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('drag-over');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file && file.type === 'application/pdf') {
        handleFile(file);
    } else {
        alert('Por favor, sube un archivo PDF válido.');
    }
});

fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) handleFile(file);
});

async function handleFile(file) {
    originalFileName = file.name;
    fileNameText.textContent = originalFileName;

    // UI Transitions
    dropZone.classList.add('hidden');
    statusArea.classList.remove('hidden');
    actionArea.classList.add('hidden');
    progressBar.style.width = '0%';
    percentageText.textContent = '0%';
    pageCountText.textContent = 'Analizando páginas...';
    processLabel.textContent = 'Procesando...';

    try {
        // Usamos el logo oficial (Data URI) para máxima compatibilidad
        const logoResponse = await fetch(KOOLBRAND_LOGO_DATA);
        const logoBytes = await logoResponse.arrayBuffer();

        processedBlob = await processPDF(file, logoBytes, (percent, current, total) => {
            progressBar.style.width = `${percent}%`;
            percentageText.textContent = `${percent}%`;
            pageCountText.textContent = `Página ${current} de ${total}`;
        });

        // Completion
        processLabel.textContent = '¡Completado!';
        processLabel.style.color = '#4ade80';
        actionArea.classList.remove('hidden');
    } catch (error) {
        console.error(error);
        alert('Hubo un error al procesar el PDF. Asegúrate de que no esté protegido por contraseña.');
        resetApp();
    }
}

downloadBtn.addEventListener('click', () => {
    if (!processedBlob) {
        console.error("No hay archivo procesado disponible.");
        return;
    }

    console.log("Iniciando descarga de:", originalFileName);
    const url = URL.createObjectURL(processedBlob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `limpio_${originalFileName}`;

    document.body.appendChild(a);

    // Pequeño delay para asegurar que el DOM ha registrado el elemento
    setTimeout(() => {
        a.click();

        // Limpieza después de un pequeño delay
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }, 50);
});

resetBtn.addEventListener('click', resetApp);

function resetApp() {
    dropZone.classList.remove('hidden');
    statusArea.classList.add('hidden');
    fileInput.value = '';
    processedBlob = null;
}
